version: '4.27.1'

services:
  postgres:
    image: postgis/postgis:16-3.4-alpine
    container_name: climate-db
    env_file:
      - production.env
    ports:
    - '5432:5432'
    logging:
      driver: "json-file"
      options:
        max-size: "1M"
        max-file: "10"

  app:
    build:
      dockerfile: Dockerfile
    container_name: climatemq
    command: wait-for-it postgres:5432 -- python manage.py runserver 0.0.0.0:8000 --settings=geodjango.settings
    env_file:
      - production.env
    restart: unless-stopped
    volumes:
      - .:/climatemq
    depends_on:
      - postgres
    logging:
      driver: "json-file"
      options:
        max-size: "1M"
        max-file: "10"
    ports:
      - '8080:8000'